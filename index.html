<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>Leaflet Routing Example</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <!-- Leaflet Routing Machine CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />

  <style>
    html, body, #map {
      height: 100%;
      margin: 0;
      font-family: sans-serif;
    }

    #routeControlBtn {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 9999;
      padding: 10px 16px;
      background-color: #1976d2;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
    }

    .custom-popup {
      padding: 6px 10px;
      font-size: 14px;
      color: #333;
    }

    .custom-popup strong {
      color: #1976d2;
    }
  </style>
</head>
<body>

<button id="routeControlBtn">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á</button>
<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<!-- Leaflet Routing Machine -->
<script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>

<script>
  const map = L.map('map').setView([13.75, 100.5], 10);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '¬© OpenStreetMap contributors'
  }).addTo(map);

  let control;
  let waypoints = [];
  let isSelecting = false;

  const controlBtn = document.getElementById('routeControlBtn');

  controlBtn.addEventListener('click', () => {
    if (controlBtn.innerText === '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á') {
      isSelecting = true;
      waypoints = [];
      if (control) map.removeControl(control);
      controlBtn.innerText = '‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï';
      alert('‡∏Ñ‡∏•‡∏¥‡∏Å‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏•‡∏¥‡∏Å‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢ ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏∏‡∏î‡∏ó‡∏≤‡∏á‡∏ú‡πà‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏Å');
    } else {
      resetRouting();
    }
  });

  function showPopup(latlng, html) {
    L.popup({ className: 'custom-popup' })
      .setLatLng(latlng)
      .setContent(`<strong>${html}</strong>`)
      .openOn(map);
  }

  map.on('click', function (e) {
    if (!isSelecting) return;

    if (waypoints.length === 0) {
      waypoints.push(e.latlng); // Start
      showPopup(e.latlng, "üö© ‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô");

    } else if (waypoints.length === 1) {
      waypoints.push(e.latlng); // End
      showPopup(e.latlng, "üèÅ ‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢");
      drawRoute();
      controlBtn.innerText = "‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï";

    } else {
      // Insert waypoint before destination
      waypoints.splice(waypoints.length - 1, 0, e.latlng);
      showPopup(e.latlng, `‡∏à‡∏∏‡∏î‡∏ó‡∏≤‡∏á‡∏ú‡πà‡∏≤‡∏ô ${waypoints.length - 2}`);
      drawRoute();
    }
  });

  function drawRoute() {
    if (control) map.removeControl(control);

    control = L.Routing.control({
      waypoints: waypoints,
      routeWhileDragging: true,
      draggableWaypoints: true,
      addWaypoints: true,
      showAlternatives: true,
      altLineOptions: [
        { styles: [{ color: 'deepskyblue', opacity: 0.7, weight: 5 }] },
        { styles: [{ color: 'gold', opacity: 0.7, weight: 5 }] }
      ],
      lineOptions: {
        styles: [{ color: 'navy', opacity: 0.8, weight: 6 }]
      },
      createMarker: function (i, wp, nWps) {
        let label = "";
        if (i === 0) {
          label = "üö© ‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô";
        } else if (i === 1) {
          label = "üèÅ ‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢";
        } else {
          label = `‡∏à‡∏∏‡∏î‡∏ó‡∏≤‡∏á‡∏ú‡πà‡∏≤‡∏ô ${i - 1}`;
        }

        return L.marker(wp.latLng, { draggable: true })
          .bindPopup(`<div class="custom-popup"><strong>${label}</strong></div>`);
      }
    })
      .on('routesfound', function (e) {
        let summary = e.routes[0].summary;
        let html = `
          <div class="custom-popup">
            <strong>‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å</strong><br/>
            ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á: ${(summary.totalDistance / 1000).toFixed(2)} ‡∏Å‡∏°.<br/>
            ‡πÄ‡∏ß‡∏•‡∏≤: ${(summary.totalTime / 60).toFixed(1)} ‡∏ô‡∏≤‡∏ó‡∏µ
          </div>
        `;
        if (e.routes[1]) {
          let alt1 = e.routes[1].summary;
          html += `
            <div class="custom-popup">
              <strong>‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏™‡∏≥‡∏£‡∏≠‡∏á 1</strong><br/>
              ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á: ${(alt1.totalDistance / 1000).toFixed(2)} ‡∏Å‡∏°.<br/>
              ‡πÄ‡∏ß‡∏•‡∏≤: ${(alt1.totalTime / 60).toFixed(1)} ‡∏ô‡∏≤‡∏ó‡∏µ
            </div>
          `;
        }
        if (e.routes[2]) {
          let alt2 = e.routes[2].summary;
          html += `
            <div class="custom-popup">
              <strong>‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏™‡∏≥‡∏£‡∏≠‡∏á 2</strong><br/>
              ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á: ${(alt2.totalDistance / 1000).toFixed(2)} ‡∏Å‡∏°.<br/>
              ‡πÄ‡∏ß‡∏•‡∏≤: ${(alt2.totalTime / 60).toFixed(1)} ‡∏ô‡∏≤‡∏ó‡∏µ
            </div>
          `;
        }

        L.popup({ maxWidth: 250, className: 'custom-popup' })
          .setLatLng(waypoints[1])
          .setContent(html)
          .openOn(map);
      })
      .addTo(map);
  }

  function resetRouting() {
    if (control) map.removeControl(control);
    control = null;
    waypoints = [];
    isSelecting = false;
    controlBtn.innerText = '‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á';
  }
</script>

</body>
</html>

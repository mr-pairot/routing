<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Leaflet Routing ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />

  <style>
    body { margin: 0; }
    #map { height: 100vh; }

    #controlBtn {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 1000;
      background: #0078D4;
      color: white;
      border: none;
      padding: 10px 16px;
      font-size: 14px;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }

    #info {
      position: absolute;
      top: 60px;
      left: 10px;
      z-index: 1000;
      background: white;
      padding: 10px;
      border-radius: 8px;
      min-width: 220px;
      box-shadow: 0 0 5px rgba(0,0,0,0.2);
      font-size: 14px;
      line-height: 1.5;
    }

    .popup-content {
      font-size: 14px;
      padding: 4px 8px;
      font-weight: bold;
      color: #333;
    }
  </style>
</head>
<body>

<button id="controlBtn">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á</button>
<div id="info">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢</div>
<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>

<script>
  const map = L.map('map').setView([13.75, 100.5], 12);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

  const controlBtn = document.getElementById('controlBtn');
  const infoDiv = document.getElementById('info');

  let startPoint = null;
  let endPoint = null;
  let routingControl = null;
  let isSelecting = false;

  function formatRouteSummary(route) {
    const distanceKm = (route.summary.totalDistance / 1000).toFixed(2);
    const durationMin = (route.summary.totalTime / 60).toFixed(1);
    return `‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á: ${distanceKm} km<br>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á: ${durationMin} ‡∏ô‡∏≤‡∏ó‡∏µ`;
  }

  function createPopupHtml(text) {
    return `<div class="popup-content">${text}</div>`;
  }

  function resetRouting() {
    startPoint = null;
    endPoint = null;
    isSelecting = false;

    if (routingControl) {
      map.removeControl(routingControl);
      routingControl = null;
    }

    infoDiv.innerHTML = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢";
    controlBtn.innerText = "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á";
  }

  controlBtn.addEventListener('click', () => {
    if (isSelecting || routingControl) {
      resetRouting();  // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï
    } else {
      isSelecting = true;
      alert("‡∏Ñ‡∏•‡∏¥‡∏Å‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà");
    }
  });

  map.on('click', function (e) {
    if (!isSelecting) return;

    if (!startPoint) {
      startPoint = e.latlng;
      L.popup()
        .setLatLng(startPoint)
        .setContent(createPopupHtml("üö© ‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô"))
        .openOn(map);
      alert("‡∏Ñ‡∏•‡∏¥‡∏Å‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà");
    } else if (!endPoint) {
      endPoint = e.latlng;
      L.popup()
        .setLatLng(endPoint)
        .setContent(createPopupHtml("üèÅ ‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢"))
        .openOn(map);
      drawRoute();
      controlBtn.innerText = "‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï";
      isSelecting = false;
    }
  });

  function drawRoute() {
    if (routingControl) {
      map.removeControl(routingControl);
    }

    routingControl = L.Routing.control({
      waypoints: [startPoint, endPoint],
      routeWhileDragging: true,
      showAlternatives: true,
      altLineOptions: {
        styles: [{ color: 'gray', opacity: 0.7, weight: 4 }]
      },
      createMarker: function(i, wp, nWps) {
        return L.marker(wp.latLng, {
          draggable: true
        }).bindPopup(createPopupHtml(i === 0 ? "üö© ‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô" : "üèÅ ‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢"));
      }
    })
    .on('routesfound', function(e) {
      const routes = e.routes;
      let summaryHtml = '';
      routes.forEach((route, i) => {
        summaryHtml += `<div><strong>‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á ${i + 1}</strong><br>${formatRouteSummary(route)}</div><hr>`;
      });
      infoDiv.innerHTML = `<strong>‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á:</strong><br>${summaryHtml}`;
    })
    .on('waypointschanged', function() {
      infoDiv.innerHTML = `<strong>‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á:</strong><br>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏´‡∏°‡πà...`;
    })
    .addTo(map);
  }
</script>

</body>
</html>
